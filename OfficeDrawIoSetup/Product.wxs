<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
 
  <Product Id="*" 
           Name="Office Draw.io !(bind.FileVersion.OfficeDrawIo_dll)" 
           Language="1033"
           Version="!(bind.FileVersion.OfficeDrawIo_dll)"
           Manufacturer="George Samartzidis" 
           UpgradeCode="5db2e48f-7431-4db0-be29-29a1649aa678">

    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine"  InstallPrivileges="elevated" AdminImage="yes" />

		<!--<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />-->
    <Upgrade Id="5db2e48f-7431-4db0-be29-29a1649aa678">
      <UpgradeVersion OnlyDetect="no" Property="PREVIOUSFOUND"
                      Minimum="1.0.0.0"  IncludeMinimum="yes"
                      Maximum="99.0.0.0" IncludeMaximum="no" />
    </Upgrade>

    <MediaTemplate EmbedCab="yes" />

    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

		<Feature Id="ProductFeature" Title="OfficeDrawIoSetup" Level="1">
			<ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="Registry_FriendlyName" />
      <ComponentRef Id="Registry_Description" />
      <ComponentRef Id="Registry_Manifest" />
      <ComponentRef Id="Registry_LoadBehavior" />
		</Feature>

    <PropertyRef Id="NETFRAMEWORK45" />
    <Condition Message="[ProductName] Requires .NET Framework 4.6 or later to be installed">
      <![CDATA[Installed OR (NETFRAMEWORK45 AND NETFRAMEWORK45 >= "#393295")]]> <!-- 4.6=393295 4.7.2=461808-->
    </Condition>

    <UIRef Id="WixUI_Minimal" />    
 
    <InstallExecuteSequence>
      <RemoveExistingProducts After="InstallInitialize" />
    </InstallExecuteSequence>
 
	</Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="OfficeDrawIo" />

        <Component Id="Registry_FriendlyName">
          <RegistryValue Id="RegKey_FriendlyName" Root="HKLM"
                         Key="Software\Microsoft\Office\Word\AddIns\OfficeDrawIo"
                         Name="FriendlyName"
                         Value="OfficeDrawIo Add-In"
                         Type="string" KeyPath="yes" />
        </Component>

        <Component Id="Registry_Description">
          <RegistryValue Id="RegKey_Description" Root="HKLM"
                         Key="Software\Microsoft\Office\Word\AddIns\OfficeDrawIo"
                         Name="Description"
                         Value="OfficeDrawIo Add-In"
                         Type="string" KeyPath="yes" />
        </Component>

        <Component Id="Registry_Manifest">
          <RegistryValue Id="RegKey_Manifest" Root="HKLM"
                         Key="Software\Microsoft\Office\Word\AddIns\OfficeDrawIo"
                         Name="Manifest" Value="[INSTALLFOLDER]OfficeDrawIo.vsto|vstolocal"
                         Type="string" KeyPath="yes" />
        </Component>

        <Component Id="Registry_LoadBehavior">
          <RegistryValue Id="RegKey_LoadBehavior" Root="HKLM"
                         Key="Software\Microsoft\Office\Word\AddIns\OfficeDrawIo"
                         Name="LoadBehavior" Value="3"
                         Type="integer" KeyPath="yes" />
        </Component>

      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="OfficeDrawIo" Guid="{73A8EBD0-DD7D-42E9-A94B-3983F2D8C524}">

        <File Id="OfficeDrawIo_vsto" Name="OfficeDrawIo.vsto" Source="$(var.OfficeDrawIoBin)"></File>
        <File Id="OfficeDrawIo_dll_manifest" Name="OfficeDrawIo.dll.manifest" Source="$(var.OfficeDrawIoBin)"></File>
        <File Id="OfficeDrawIo_dll" Name="OfficeDrawIo.dll" Source="$(var.OfficeDrawIoBin)" />
        <File Id="MSOfficeToolsCommon_dll" Name="Microsoft.Office.Tools.Common.v4.0.Utilities.dll" Source="$(var.OfficeDrawIoBin)"></File>
        <File Id="MSOfficeToolsWord_dll" Name="Microsoft.Office.Tools.Word.v4.0.Utilities.dll" Source="$(var.OfficeDrawIoBin)"></File>

      </Component>
    </ComponentGroup>
  </Fragment>

</Wix>
